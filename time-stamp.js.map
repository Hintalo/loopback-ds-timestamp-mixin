{"version":3,"sources":["time-stamp.js"],"names":["debug","warn","options","message","silenceWarnings","console","Model","bootOptions","modelName","createdAt","updatedAt","required","validateUpsert","settings","pluralModelName","createdAtProps","type","Date","defaultFn","createdAtModelConfig","defineProperty","updatedAtProps","updatedAtModelConfig","observe","ctx","next","skipUpdatedAt","instance","id","where","data","module","exports","default"],"mappings":";;;;;;;;AAAA;;;;;;AAEA,IAAMA,QAAQ,sBAAd;AACA,IAAMC,OAAO,SAAPA,IAAO,CAACC,OAAD,EAAUC,OAAV,EAAsB;AACjC,MAAI,CAACD,QAAQE,eAAb,EAA8B;AAC5BC,YAAQJ,IAAR,CAAaE,OAAb;AACD;AACF,CAJD;;kBAMe,UAACG,KAAD,EAA6B;AAAA,MAArBC,WAAqB,uEAAP,EAAO;;AAC1CP,QAAM,8BAAN,EAAsCM,MAAME,SAA5C;;AAEA,MAAMN,UAAU,SAAc;AAC5BO,eAAW,WADiB;AAE5BC,eAAW,WAFiB;AAG5BC,cAAU,IAHkB;AAI5BC,oBAAgB,KAJY,EAIL;AACvBR,qBAAiB;AALW,GAAd,EAMbG,WANa,CAAhB;;AAQAP,QAAM,SAAN,EAAiBE,OAAjB;;AAEA,MAAI,CAACA,QAAQU,cAAT,IAA2BN,MAAMO,QAAN,CAAeD,cAA9C,EAA8D;AAC5DN,UAAMO,QAAN,CAAeD,cAAf,GAAgC,KAAhC;AACAX,SAAKC,OAAL,EAAiBI,MAAMQ,eAAvB;AACD;;AAED,MAAIR,MAAMO,QAAN,CAAeD,cAAf,IAAiCV,QAAQS,QAA7C,EAAuD;AACrDV,SAAKC,OAAL,mBAA6BI,MAAMQ,eAAnC;AAED;;AAED,MAAMC,iBAAiB,SAAc;AACnCC,UAAMC,IAD6B;AAEnCN,cAAUT,QAAQS,QAFiB;AAGnCO,eAAW;AAHwB,GAAd,EAIpBhB,QAAQiB,oBAAR,GAA+BjB,QAAQiB,oBAAvC,GAA8D,EAJ1C,CAAvB;;AAMAb,QAAMc,cAAN,CAAqBlB,QAAQO,SAA7B,EAAwCM,cAAxC;;AAEA,MAAMM,iBAAiB,SAAc;AACnCL,UAAMC,IAD6B;AAEnCN,cAAUT,QAAQS;AAFiB,GAAd,EAGpBT,QAAQoB,oBAAR,GAA+BpB,QAAQoB,oBAAvC,GAA8D,EAH1C,CAAvB;;AAKAhB,QAAMc,cAAN,CAAqBlB,QAAQQ,SAA7B,EAAwCW,cAAxC;;AAEAf,QAAMiB,OAAN,CAAc,aAAd,EAA6B,UAACC,GAAD,EAAMC,IAAN,EAAe;AAC1CzB,UAAM,aAAN,EAAqBwB,IAAItB,OAAzB;AACA,QAAIsB,IAAItB,OAAJ,IAAesB,IAAItB,OAAJ,CAAYwB,aAA/B,EAA8C;AAAE,aAAOD,MAAP;AAAgB;AAChE,QAAID,IAAIG,QAAR,EAAkB;AAChB3B,YAAM,uBAAN,EAA+BwB,IAAIlB,KAAJ,CAAUE,SAAzC,EAAoDN,QAAQQ,SAA5D,EAAuEc,IAAIG,QAAJ,CAAaC,EAApF;AACAJ,UAAIG,QAAJ,CAAazB,QAAQQ,SAArB,IAAkC,IAAIO,IAAJ,EAAlC;AACD,KAHD,MAGO;AACLjB,YAAM,iCAAN,EACMwB,IAAIlB,KAAJ,CAAUQ,eADhB,EACiCZ,QAAQQ,SADzC,EACoDc,IAAIK,KADxD;AAEAL,UAAIM,IAAJ,CAAS5B,QAAQQ,SAAjB,IAA8B,IAAIO,IAAJ,EAA9B;AACD;AACD,WAAOQ,MAAP;AACD,GAZD;AAaD,C;;AAEDM,OAAOC,OAAP,GAAiBA,QAAQC,OAAzB","file":"time-stamp.js","sourcesContent":["import _debug from './debug';\n\nconst debug = _debug();\nconst warn = (options, message) => {\n  if (!options.silenceWarnings) {\n    console.warn(message);\n  }\n};\n\nexport default (Model, bootOptions = {}) => {\n  debug('TimeStamp mixin for Model %s', Model.modelName);\n\n  const options = Object.assign({\n    createdAt: 'createdAt',\n    updatedAt: 'updatedAt',\n    required: true,\n    validateUpsert: false, // default to turning validation off\n    silenceWarnings: false,\n  }, bootOptions);\n\n  debug('options', options);\n\n  if (!options.validateUpsert && Model.settings.validateUpsert) {\n    Model.settings.validateUpsert = false;\n    warn(options, `${Model.pluralModelName} settings.validateUpsert was overriden to false`);\n  }\n\n  if (Model.settings.validateUpsert && options.required) {\n    warn(options, `Upserts for ${Model.pluralModelName} will fail when\n          validation is turned on and time stamps are required`);\n  }\n\n  const createdAtProps = Object.assign({\n    type: Date,\n    required: options.required,\n    defaultFn: 'now',\n  }, options.createdAtModelConfig ? options.createdAtModelConfig : {});\n\n  Model.defineProperty(options.createdAt, createdAtProps);\n\n  const updatedAtProps = Object.assign({\n    type: Date,\n    required: options.required,\n  }, options.updatedAtModelConfig ? options.updatedAtModelConfig : {});\n\n  Model.defineProperty(options.updatedAt, updatedAtProps);\n\n  Model.observe('before save', (ctx, next) => {\n    debug('ctx.options', ctx.options);\n    if (ctx.options && ctx.options.skipUpdatedAt) { return next(); }\n    if (ctx.instance) {\n      debug('%s.%s before save: %s', ctx.Model.modelName, options.updatedAt, ctx.instance.id);\n      ctx.instance[options.updatedAt] = new Date();\n    } else {\n      debug('%s.%s before update matching %j',\n            ctx.Model.pluralModelName, options.updatedAt, ctx.where);\n      ctx.data[options.updatedAt] = new Date();\n    }\n    return next();\n  });\n};\n\nmodule.exports = exports.default;\n"],"sourceRoot":"c:\\dev\\github_com\\Hintalo\\loopback-ds-timestamp-mixin\\es6"}